#!/bin/bash

#Take the PID of the current xfce4 session 
pidXFCE=$(echo $(ps -C xfce4-session -o pid=))

#Change the DBUS_SESSION_BUS_ADDRESS
export DBUS_SESSION_BUS_ADDRESS=$(grep -z DBUS_SESSION_BUS_ADDRESS /proc/$pidXFCE/environ|cut -d= -f2-)

wallpaperDirectory="/usr/share/backgrounds/xfce"

IFS='
'
while true
do
	#Put all the files in a table
	tablePictures=( $(ls $wallpaperDirectory) )
	nbWallpapers=${#tablePictures[@]}
	#Choose a random wallpaper
	randomWallpaper="${tablePictures[RANDOM % nbWallpapers]}"
	xfconf-query -c xfce4-desktop -p /backdrop/screen0/monitor0/workspace0/last-image --set /usr/share/backgrounds/xfce/$randomWallpaper
	sleep 30m

done

exit 0
